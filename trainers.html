<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decrypt and Download JSON Backup</title>
</head>
<body>
    <h2>Select Backup File to Decrypt</h2>
    <input type="file" id="backupFileInput">
    <button onclick="decryptAndDownload()">Decrypt and Download</button>

    <div id="decryptedData" style="display: none;"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        function decryptAndDownload() {
            const fileInput = document.getElementById('backupFileInput');
            const file = fileInput.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const encryptedData = event.target.result;

                    // Decrypt the encrypted data using AES decryption
                    const decryptedBytes = CryptoJS.AES.decrypt(encryptedData, 'Aubdgh6SDkuihS756db867astgsm');
                    const decryptedData = decryptedBytes.toString(CryptoJS.enc.Utf8);

                    try {
                        const jsonData = JSON.parse(decryptedData);
                        const jsonString = JSON.stringify(jsonData, null, 2);

                        // Display decrypted data (optional)
                        const decryptedDataDiv = document.getElementById('decryptedData');
                        decryptedDataDiv.innerText = jsonString;
                        decryptedDataDiv.style.display = 'block';

                        // Create a Blob object with the decrypted JSON data
                        const blob = new Blob([jsonString], { type: 'application/json' });

                        // Create a temporary anchor element for downloading
                        const a = document.createElement('a');
                        a.href = window.URL.createObjectURL(blob);
                        a.download = 'decrypted_backup.json';

                        // Programmatically trigger a click event on the anchor element
                        // to initiate the download
                        a.click();

                        // Remove the temporary anchor element
                        window.URL.revokeObjectURL(a.href);
                    } catch (error) {
                        console.error('Error parsing decrypted JSON data:', error);
                        alert('Error parsing decrypted JSON data. Invalid backup file.');
                    }
                };

                reader.readAsText(file);
            } else {
                alert('Please select a file to decrypt.');
            }
        }
    </script>
</body>
</html>
